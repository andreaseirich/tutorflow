{% extends 'core/base.html' %}
{% load i18n %}
{% load currency %}

{% block title %}{% blocktrans with id=invoice.id %}Invoice {{ id }}{% endblocktrans %} - TutorFlow{% endblock %}

{% block content %}
<h1>{% blocktrans with id=invoice.id %}Invoice {{ id }}{% endblocktrans %}</h1>

<div class="btn-group">
    <a href="{% url 'billing:invoice_list' %}" class="btn btn-secondary">{% trans "Back to List" %}</a>
    {% if not invoice.document %}
    <a href="{% url 'billing:invoice_generate_document' invoice.pk %}" class="btn">üìÑ {% trans "Generate Document" %}</a>
    {% else %}
    <a href="{% url 'billing:invoice_document' invoice.pk %}" class="btn" target="_blank">üìÑ {% trans "View Document" %}</a>
    {% endif %}
    <a href="{% url 'billing:invoice_delete' invoice.pk %}" class="btn btn-danger">üóëÔ∏è {% trans "Delete" %}</a>
</div>

<h2>{% trans "Details" %}</h2>
<table>
    <tr><th>{% trans "Payer" %}</th><td>{{ invoice.payer_name }}</td></tr>
    {% if invoice.payer_address %}<tr><th>{% trans "Address" %}</th><td>{{ invoice.payer_address|linebreaks }}</td></tr>{% endif %}
    {% if invoice.contract %}<tr><th>{% trans "Contract" %}</th><td><a href="{% url 'contracts:detail' invoice.contract.pk %}">{{ invoice.contract }}</a></td></tr>{% endif %}
    <tr><th>{% trans "Period" %}</th><td>{{ invoice.period_start|date:"SHORT_DATE_FORMAT" }} - {{ invoice.period_end|date:"SHORT_DATE_FORMAT" }}</td></tr>
    <tr><th>{% trans "Status" %}</th><td>{{ invoice.get_status_display }}</td></tr>
    <tr><th>{% trans "Total Amount" %}</th><td><strong>{{ invoice.total_amount|euro }}</strong></td></tr>
    <tr><th>{% trans "Created" %}</th><td>{{ invoice.created_at|date:"SHORT_DATETIME_FORMAT" }}</td></tr>
</table>

<h2>{% trans "Invoice Items" %}</h2>
{% if invoice.items.all %}
<table>
    <thead>
        <tr>
            <th>{% trans "Date" %}</th>
            <th>{% trans "Description" %}</th>
            <th>{% trans "Duration" %}</th>
            <th>{% trans "Amount" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for item in invoice.items.all %}
        <tr>
            <td>{{ item.date|date:"SHORT_DATE_FORMAT" }}</td>
            <td>{{ item.description }}</td>
            <td>{% blocktrans with minutes=item.duration_minutes %}{{ minutes }} Min.{% endblocktrans %}</td>
            <td>{{ item.amount|euro }}</td>
        </tr>
        {% endfor %}
        <tr style="font-weight: bold; border-top: 2px solid #333;">
            <td colspan="3">{% trans "Total:" %}</td>
            <td>{{ invoice.total_amount|euro }}</td>
        </tr>
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <p>{% trans "No invoice items available." %}</p>
</div>
{% endif %}
{% endblock %}
