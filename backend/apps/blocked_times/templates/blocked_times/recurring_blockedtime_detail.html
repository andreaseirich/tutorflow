{% extends 'core/base.html' %}
{% load i18n %}

{% block title %}{{ recurring_blocked_time }} - TutorFlow{% endblock %}

{% block content %}
<h1>{% trans "Recurring Blocked Time" %}</h1>

<div class="btn-group">
    <a href="{% url 'blocked_times:recurring_update' recurring_blocked_time.pk %}" class="btn">{% trans "Edit" %}</a>
    <a href="{% url 'blocked_times:recurring_delete' recurring_blocked_time.pk %}" class="btn btn-danger">{% trans "Delete" %}</a>
    <a href="{% url 'lessons:week' %}" class="btn btn-secondary">‚Üê {% trans "Back to Calendar" %}</a>
</div>

<h2>{% trans "Details" %}</h2>
<table>
    <tr><th>{% trans "Title" %}</th><td>{{ recurring_blocked_time.title }}</td></tr>
    {% if recurring_blocked_time.description %}
    <tr><th>{% trans "Description" %}</th><td>{{ recurring_blocked_time.description }}</td></tr>
    {% endif %}
    <tr><th>{% trans "Weekdays" %}</th><td>{{ recurring_blocked_time.get_active_weekdays_display }}</td></tr>
    <tr><th>{% trans "Start Date" %}</th><td>{{ recurring_blocked_time.start_date }}</td></tr>
    <tr><th>{% trans "End Date" %}</th><td>{{ recurring_blocked_time.end_date|default:_("Not set") }}</td></tr>
    <tr><th>{% trans "Time" %}</th><td>{{ recurring_blocked_time.start_time }} - {{ recurring_blocked_time.end_time }}</td></tr>
    <tr><th>{% trans "Recurrence Type" %}</th><td>{{ recurring_blocked_time.get_recurrence_type_display }}</td></tr>
    <tr><th>{% trans "Status" %}</th><td>{% if recurring_blocked_time.is_active %}<span style="color: #28a745;">{% trans "Active" %}</span>{% else %}<span style="color: #495057;">{% trans "Inactive" %}</span>{% endif %}</td></tr>
    <tr><th>{% trans "Created" %}</th><td>{{ recurring_blocked_time.created_at|date:"SHORT_DATETIME_FORMAT" }}</td></tr>
    <tr><th>{% trans "Last updated" %}</th><td>{{ recurring_blocked_time.updated_at|date:"SHORT_DATETIME_FORMAT" }}</td></tr>
</table>

<h2>{% trans "Preview" %}</h2>
<p>{% blocktrans count counter=preview|length %}This series would generate <strong>{{ counter }}</strong> blocked time.{% plural %}This series would generate <strong>{{ counter }}</strong> blocked times.{% endblocktrans %}</p>
{% if preview %}
<p>{% trans "First 10 appointments:" %}</p>
<ul>
    {% for blocked_time in preview|slice:":10" %}
    <li>{% blocktrans with date=blocked_time.start_datetime|date:"SHORT_DATE_FORMAT" start=blocked_time.start_datetime|time:"TIME_FORMAT" end=blocked_time.end_datetime|time:"TIME_FORMAT" title=blocked_time.title %}{{ date }} from {{ start }} to {{ end }} - {{ title }}{% endblocktrans %}</li>
    {% endfor %}
</ul>
{% endif %}

<h2>{% trans "Actions" %}</h2>
<form method="post" action="{% url 'blocked_times:recurring_generate' recurring_blocked_time.pk %}">
    {% csrf_token %}
    <div class="form-group">
        <label>
            <input type="checkbox" name="check_conflicts" checked> {% trans "Check conflicts with lessons" %}
        </label>
    </div>
    <button type="submit" class="btn btn-success">{% trans "Generate blocked times from this series" %}</button>
</form>
<p><small>{% trans "Note: Existing blocked times will be skipped." %}</small></p>
{% endblock %}
