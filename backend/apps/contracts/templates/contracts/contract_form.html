{% extends 'core/base.html' %}
{% load i18n %}

{% block title %}{% if object %}{% trans "Edit Contract" %}{% else %}{% trans "New Contract" %}{% endif %} - TutorFlow{% endblock %}

{% block content %}
<h1>{% if object %}{% trans "Edit Contract" %}{% else %}{% trans "New Contract" %}{% endif %}</h1>

<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    
    {% if formset %}
    <h2>{% trans "Monthly Planning" %}</h2>
    <p>{% trans "Enter the planned units for each month in the contract period." %}</p>
    
    {{ formset.management_form }}
    <table>
        <thead>
            <tr>
                <th>{% trans "Year" %}</th>
                <th>{% trans "Month" %}</th>
                <th>{% trans "Planned Units" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for form in formset %}
            <tr>
                <td>{{ form.year.value }}</td>
                <td>{{ form.year.value }}-{{ form.month.value|stringformat:"02d" }}</td>
                <td>
                    {{ form.id }}
                    {{ form.year.as_hidden }}
                    {{ form.month.as_hidden }}
                    {{ form.planned_units }}
                    {% if form.planned_units.errors %}
                    <div class="error">{{ form.planned_units.errors }}</div>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif form.has_monthly_planning_limit.value == False %}
    <p class="text-muted">{% trans "No monthly planning required. This contract has no maximum number of units planned." %}</p>
    {% endif %}
    
    <div class="btn-group">
        <button type="submit" class="btn btn-success">{% trans "Save" %}</button>
        <a href="{% url 'contracts:list' %}" class="btn btn-secondary">{% trans "Cancel" %}</a>
    </div>
</form>

{% if not object %}
<script>
// Beim Erstellen: Nach Speichern zur Update-View weiterleiten, um monatliche Planung zu bearbeiten
// Dies wird durch die View-Logik gehandhabt
</script>
{% endif %}
{% endblock %}
