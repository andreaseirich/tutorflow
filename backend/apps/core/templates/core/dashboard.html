{% extends 'core/base.html' %}
{% load i18n %}
{% load currency %}

{% block title %}{% trans "Dashboard" %} - TutorFlow{% endblock %}

{% block content %}
<h1>{% trans "Dashboard" %}{% if is_premium %} <span class="premium-badge">{% trans "Premium" %}</span>{% endif %}</h1>

<h2>{% trans "Today's Lessons" %}</h2>
{% if today_lessons %}
<table>
    <thead>
        <tr>
            <th>{% trans "Time" %}</th>
            <th>{% trans "Student" %}</th>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Conflicts" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for lesson in today_lessons %}
        <tr>
            <td>{{ lesson.start_time }}</td>
            <td>{{ lesson.contract.student }}</td>
            <td>{{ lesson.get_status_display }}</td>
            <td>
                {% if lesson.conflicts %}
                <span class="conflict-icon">⚠</span> <span class="conflict">{% blocktrans count counter=lesson.conflicts|length %}{{ counter }} conflict{% plural %}{{ counter }} conflicts{% endblocktrans %}</span>
                {% else %}
                <span style="color: #28a745;">✓ {% trans "OK" %}</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>{% trans "No lessons scheduled for today." %}</p>
{% endif %}

<h2>{% trans "Upcoming Lessons (7 days)" %}</h2>
{% if upcoming_lessons %}
<table>
    <thead>
        <tr>
            <th>{% trans "Date" %}</th>
            <th>{% trans "Time" %}</th>
            <th>{% trans "Student" %}</th>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Conflicts" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for lesson in upcoming_lessons %}
        <tr>
            <td>{{ lesson.date }}</td>
            <td>{{ lesson.start_time }}</td>
            <td>{{ lesson.contract.student }}</td>
            <td>{{ lesson.get_status_display }}</td>
            <td>
                {% if lesson.conflicts %}
                <span class="conflict-icon">⚠</span> <span class="conflict">{% blocktrans count counter=lesson.conflicts|length %}{{ counter }} conflict{% plural %}{{ counter }} conflicts{% endblocktrans %}</span>
                {% else %}
                <span style="color: #28a745;">✓ {% trans "OK" %}</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>{% trans "No upcoming lessons." %}</p>
{% endif %}

<h2>{% trans "Income" %} ({{ current_month }}/{{ current_year }})</h2>
<p><strong>{% trans "Paid:" %}</strong> {{ current_month_income.total_income|euro }} {% blocktrans count counter=current_month_income.lesson_count %}({{ counter }} lesson){% plural %}({{ counter }} lessons){% endblocktrans %}</p>

{% if conflict_count > 0 %}
<p class="conflict">⚠ {% blocktrans count counter=conflict_count %}{{ counter }} conflict in upcoming lessons!{% plural %}{{ counter }} conflicts in upcoming lessons!{% endblocktrans %}</p>
{% endif %}
{% endblock %}

