{% extends 'core/base.html' %}

{% block title %}Dashboard - TutorFlow{% endblock %}

{% block content %}
<h1>Dashboard</h1>

<h2>Heutige Stunden</h2>
{% if today_lessons %}
<table>
    <thead>
        <tr>
            <th>Zeit</th>
            <th>Schüler</th>
            <th>Status</th>
            <th>Konflikte</th>
        </tr>
    </thead>
    <tbody>
        {% for lesson in today_lessons %}
        <tr>
            <td>{{ lesson.start_time }}</td>
            <td>{{ lesson.contract.student }}</td>
            <td>{{ lesson.get_status_display }}</td>
            <td>
                {% if lesson.conflicts %}
                <span class="conflict-icon">⚠</span> <span class="conflict">{{ lesson.conflicts|length }} Konflikt(e)</span>
                {% else %}
                <span style="color: #28a745;">✓ OK</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>Keine Stunden für heute geplant.</p>
{% endif %}

<h2>Nächste Stunden (7 Tage)</h2>
{% if upcoming_lessons %}
<table>
    <thead>
        <tr>
            <th>Datum</th>
            <th>Zeit</th>
            <th>Schüler</th>
            <th>Status</th>
            <th>Konflikte</th>
        </tr>
    </thead>
    <tbody>
        {% for lesson in upcoming_lessons %}
        <tr>
            <td>{{ lesson.date }}</td>
            <td>{{ lesson.start_time }}</td>
            <td>{{ lesson.contract.student }}</td>
            <td>{{ lesson.get_status_display }}</td>
            <td>
                {% if lesson.conflicts %}
                <span class="conflict-icon">⚠</span> <span class="conflict">{{ lesson.conflicts|length }} Konflikt(e)</span>
                {% else %}
                <span style="color: #28a745;">✓ OK</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>Keine kommenden Stunden.</p>
{% endif %}

<h2>Einnahmen ({{ current_month }}/{{ current_year }})</h2>
<p><strong>Ausgezahlt:</strong> {{ current_month_income.total_income }}€ ({{ current_month_income.lesson_count }} Stunden)</p>

{% if conflict_count > 0 %}
<p class="conflict">⚠ {{ conflict_count }} Konflikt(e) in den nächsten Stunden!</p>
{% endif %}
{% endblock %}

