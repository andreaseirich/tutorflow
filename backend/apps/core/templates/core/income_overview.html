{% extends 'core/base.html' %}
{% load i18n %}
{% load currency %}

{% block title %}{% trans "Income Overview" %} - TutorFlow{% endblock %}

{% block content %}
<h1>{% trans "Income Overview" %}</h1>

{% if view_type == 'month' %}
<h2>{% trans "Monthly Overview" %}: {{ month|stringformat:"02d" }}/{{ year }}</h2>

<div class="btn-group" style="margin-bottom: 20px;">
    <a href="{% url 'core:income' %}?year={{ prev_year }}&month={{ prev_month }}" class="btn btn-secondary">← {% trans "Previous Month" %}</a>
    <a href="{% url 'core:income' %}?year={{ year }}" class="btn btn-secondary">{% trans "Year View" %}</a>
    <a href="{% url 'core:income' %}?year={{ next_year }}&month={{ next_month }}" class="btn btn-secondary">{% trans "Next Month" %} →</a>
</div>

<h3>{% trans "Summary" %}</h3>
<p><strong>{% trans "Total Income:" %}</strong> {{ monthly_income.total_income|euro }} {% blocktrans count counter=monthly_income.lesson_count %}({{ counter }} lesson){% plural %}({{ counter }} lessons){% endblocktrans %}</p>

<h3>{% trans "Income by Status" %}</h3>
<table>
    <thead>
        <tr>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Number of Lessons" %}</th>
            <th>{% trans "Income" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for status_code, status_data in income_by_status.items %}
        <tr>
            <td>{{ status_data.name }}</td>
            <td>{{ status_data.lesson_count }}</td>
            <td>{{ status_data.income|euro }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% else %}
<h2>{% trans "Year Overview" %}: {{ year }}</h2>

<div class="btn-group" style="margin-bottom: 20px;">
    <a href="{% url 'core:income' %}?year={{ year|add:'-1' }}" class="btn btn-secondary">← {% trans "Previous Year" %}</a>
    <a href="{% url 'core:income' %}?year={{ year|add:'1' }}" class="btn btn-secondary">{% trans "Next Year" %} →</a>
</div>

<h3>{% trans "Year Summary" %}</h3>
<p><strong>{% trans "Total:" %}</strong> {{ yearly_income.total_income|euro }} {% blocktrans count counter=yearly_income.total_lessons %}({{ counter }} lesson){% plural %}({{ counter }} lessons){% endblocktrans %}</p>

<h3>{% trans "Monthly Breakdown" %}</h3>
<table class="table">
    <thead>
        <tr>
            <th>{% trans "Month" %}</th>
            <th>{% trans "Lessons" %}</th>
            <th>{% trans "Income" %}</th>
            <th>{% trans "Actions" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for month_data in yearly_income.monthly_breakdown %}
        <tr>
            <td>
                {% if month_data.month == 1 %}{% trans "January" %}
                {% elif month_data.month == 2 %}{% trans "February" %}
                {% elif month_data.month == 3 %}{% trans "March" %}
                {% elif month_data.month == 4 %}{% trans "April" %}
                {% elif month_data.month == 5 %}{% trans "May" %}
                {% elif month_data.month == 6 %}{% trans "June" %}
                {% elif month_data.month == 7 %}{% trans "July" %}
                {% elif month_data.month == 8 %}{% trans "August" %}
                {% elif month_data.month == 9 %}{% trans "September" %}
                {% elif month_data.month == 10 %}{% trans "October" %}
                {% elif month_data.month == 11 %}{% trans "November" %}
                {% elif month_data.month == 12 %}{% trans "December" %}
                {% endif %} {{ month_data.year }}
            </td>
            <td>{{ month_data.lesson_count }}</td>
            <td>{{ month_data.total_income|euro }}</td>
            <td>
                <a href="{% url 'core:income' %}?year={{ month_data.year }}&month={{ month_data.month }}" class="btn btn-sm btn-primary">{% trans "View Details" %}</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>{% trans "Income by Status" %}</h3>
<table>
    <thead>
        <tr>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Number of Lessons" %}</th>
            <th>{% trans "Income" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for status_code, status_data in income_by_status.items %}
        <tr>
            <td>{{ status_data.name }}</td>
            <td>{{ status_data.lesson_count }}</td>
            <td>{{ status_data.income|euro }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endblock %}
