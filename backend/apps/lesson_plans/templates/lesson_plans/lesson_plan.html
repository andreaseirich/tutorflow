{% extends 'core/base.html' %}
{% load i18n %}

{% block title %}{% blocktrans with date=lesson.date student=lesson.contract.student %}Lesson Plan - {{ date }} - {{ student }}{% endblocktrans %} - TutorFlow{% endblock %}

{% block content %}
<h1>{% trans "Lesson Plan" %}</h1>

<div style="margin-bottom: 20px;">
    <a href="{% url 'lessons:week' %}?year={{ year }}&month={{ month }}&day={{ day }}" class="btn">â† {% trans "Back to Calendar" %}</a>
    <a href="{% url 'lessons:update' lesson.pk %}?year={{ year }}&month={{ month }}&day={{ day }}" class="btn btn-primary">âœï¸ {% trans "Edit Lesson" %}</a>
    <a href="{% url 'lessons:detail' lesson.pk %}" class="btn btn-secondary">ğŸ“‹ {% trans "Lesson Details" %}</a>
</div>

<div style="background: #f9f9f9; padding: 20px; border-radius: 5px; margin-bottom: 20px;">
    <h2>{% trans "Lesson Information" %}</h2>
    <table style="width: 100%;">
        <tr>
            <td style="padding: 8px; font-weight: bold;">{% trans "Date:" %}</td>
            <td style="padding: 8px;">{{ lesson.date|date:"SHORT_DATE_FORMAT" }}</td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">{% trans "Time:" %}</td>
            <td style="padding: 8px;">{% blocktrans with time=lesson.start_time|time:"H:i" minutes=lesson.duration_minutes %}{{ time }} ({{ minutes }} Min.){% endblocktrans %}</td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">{% trans "Student:" %}</td>
            <td style="padding: 8px;">
                <a href="{% url 'students:detail' lesson.contract.student.pk %}">{{ lesson.contract.student.full_name }}</a>
            </td>
        </tr>
        <tr>
            <td style="padding: 8px; font-weight: bold;">{% trans "Status:" %}</td>
            <td style="padding: 8px;">{{ lesson.get_status_display }}</td>
        </tr>
    </table>
</div>

{% if has_lesson_plan %}
<div style="background: #e7f3ff; padding: 20px; border-radius: 5px; border-left: 4px solid #007bff; margin-bottom: 20px;">
    <h2 style="color: #007bff; margin-top: 0;">ğŸ“š {% trans "Lesson Plan" %}</h2>
    
    {% for lesson_plan in lesson_plans %}
    <div style="background: white; padding: 15px; border-radius: 3px; margin-top: 15px; {% if not forloop.first %}opacity: 0.7;{% endif %}">
        {% if not forloop.first %}
        <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
            <em>{% trans "Previous version" %} - {{ lesson_plan.created_at|date:"SHORT_DATETIME_FORMAT" }}</em>
        </p>
        {% endif %}
        <p><strong>{% trans "Topic:" %}</strong> {{ lesson_plan.topic }}</p>
        <p><strong>{% trans "Subject:" %}</strong> {{ lesson_plan.subject }}</p>
        {% if lesson_plan.grade_level %}
        <p><strong>{% trans "Grade Level:" %}</strong> {{ lesson_plan.grade_level }}</p>
        {% endif %}
        <div style="margin-top: 15px; white-space: pre-wrap; line-height: 1.6;">{{ lesson_plan.content }}</div>
        {% if lesson_plan.llm_model %}
        <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
            <em>{% blocktrans with model=lesson_plan.llm_model %}Generated with {{ model }}{% endblocktrans %} - {{ lesson_plan.created_at|date:"SHORT_DATETIME_FORMAT" }}</em>
        </p>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}

{% if is_premium %}
<div style="background: #e7f3ff; padding: 20px; border-radius: 5px; border-left: 4px solid #007bff; margin-bottom: 20px;">
    <h2 style="color: #007bff; margin-top: 0;">ğŸ¤– {% trans "AI Lesson Plan" %}</h2>
    {% if has_lesson_plan %}
    <p>{% trans "A lesson plan has already been generated for this lesson. You can regenerate it below." %}</p>
    {% else %}
    <p>{% trans "Generate an AI-powered lesson plan for this lesson." %}</p>
    {% endif %}
    <form method="post" action="{% url 'ai:generate_lesson_plan' lesson.pk %}" style="margin-top: 15px;">
        {% csrf_token %}
        <input type="hidden" name="next" value="{% url 'lesson_plans:lesson_plan' lesson.pk %}?year={{ year }}&month={{ month }}&day={{ day }}">
        <button type="submit" class="btn" style="background: #007bff; color: white;">
            {% if has_lesson_plan %}
                ğŸ”„ {% trans "Regenerate AI Lesson Plan" %}
            {% else %}
                âœ¨ {% trans "Generate AI Lesson Plan" %}
            {% endif %}
        </button>
    </form>
</div>
{% else %}
<div style="background: #f8f9fa; padding: 20px; border-radius: 5px; border-left: 4px solid #6c757d; margin-bottom: 20px;">
    <h2 style="color: #6c757d; margin-top: 0;">ğŸ¤– {% trans "AI Lesson Plan" %} <span class="premium-badge">{% trans "Premium" %}</span></h2>
    <p>{% trans "AI-powered lesson plan generation is only available for premium users." %}</p>
    <button type="button" class="btn" style="background: #6c757d; color: white; cursor: not-allowed; opacity: 0.6;" disabled>
        âœ¨ {% trans "Generate AI Lesson Plan" %}
    </button>
</div>
{% endif %}

{% endblock %}

