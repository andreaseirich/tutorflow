{% extends 'core/base.html' %}

{% block title %}Kalender {{ month_label }} {{ year }} - TutorFlow{% endblock %}

{% block content %}
<h1>Kalender {{ month_label }} {{ year }}</h1>

<div class="btn-group">
    <a href="{% url 'lessons:calendar' %}?year={{ prev_year }}&month={{ prev_month }}" class="btn">â† Vorheriger Monat</a>
    <a href="{% url 'lessons:calendar' %}?year={{ next_year }}&month={{ next_month }}" class="btn">NÃ¤chster Monat â†’</a>
    <a href="{% url 'lessons:recurring_create' %}" class="btn btn-success">â• Serientermin anlegen</a>
    <a href="{% url 'blocked_times:recurring_create' %}" class="btn btn-warning">ğŸš« Serien-Blockzeit erstellen</a>
</div>

<p style="margin-top: 10px; color: #666; font-size: 0.9em;">
    <strong>Hinweis:</strong> Klicken Sie auf einen Tag, um eine neue Unterrichtsstunde anzulegen. 
    Klicken Sie auf eine bestehende Stunde, um sie zu bearbeiten.
</p>

<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
    <thead>
        <tr>
            {% for weekday in weekday_names %}
            <th style="border: 1px solid #ddd; padding: 10px; background: #f5f5f5; text-align: center;">{{ weekday }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for week in weeks %}
        <tr>
            {% for day in week %}
            <td style="border: 1px solid #ddd; padding: 8px; vertical-align: top; {% if not day.is_current_month %}background: #f9f9f9; color: #999;{% endif %} min-height: 100px; width: 14.28%; position: relative;">
                <div style="font-weight: bold; margin-bottom: 5px;">
                    {% if day.is_current_month %}
                    <a href="{% url 'lessons:create' %}?date={{ day.date|date:'Y-m-d' }}&year={{ year }}&month={{ month }}" 
                       style="color: #007bff; text-decoration: none; border-bottom: 1px dashed #007bff;"
                       title="Neue Stunde anlegen">
                        {{ day.date.day }}
                    </a>
                    <a href="{% url 'blocked_times:create' %}?date={{ day.date|date:'Y-m-d' }}&year={{ year }}&month={{ month }}" 
                       style="color: #856404; text-decoration: none; margin-left: 5px; font-size: 0.8em;"
                       title="Blockzeit hinzufÃ¼gen">
                        ğŸš«
                    </a>
                    {% else %}
                    {{ day.date.day }}
                    {% endif %}
                </div>
                
                {% if day.lessons %}
                <div style="margin-bottom: 5px;">
                    {% for lesson in day.lessons %}
                    <div style="display: block; background: {% if lesson.date < today %}#f5f5f5{% else %}#e3f2fd{% endif %}; padding: 3px; margin-bottom: 2px; font-size: 0.85em; border-left: 3px solid {% if lesson.id in conflicts_by_lesson %}#dc3545{% else %}#2196f3{% endif %}; {% if lesson.date < today %}opacity: 0.7;{% endif %}">
                        <a href="{% url 'lessons:detail' lesson.pk %}" 
                           style="text-decoration: none; color: #333; display: block;"
                           title="Stunde anzeigen">
                            <strong>{{ lesson.start_time|time:"H:i" }}</strong> 
                            {{ lesson.contract.student.first_name }}
                            {% if lesson.id in conflicts_by_lesson %}
                            <a href="{% url 'lessons:conflicts' lesson.pk %}" 
                               style="color: #dc3545; text-decoration: none; margin-left: 5px;"
                               title="Konflikt-Details anzeigen">âš  Details</a>
                            {% endif %}
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                {% if day.blocked_times %}
                <div>
                    {% for blocked_time in day.blocked_times %}
                    <div style="background: #fff3cd; padding: 3px; margin-bottom: 2px; font-size: 0.85em; color: #856404; border-left: 3px solid #ffc107;">
                        <a href="{% url 'blocked_times:detail' blocked_time.pk %}?year={{ year }}&month={{ month }}" 
                           style="text-decoration: none; color: #856404; display: block;"
                           title="Blockzeit anzeigen/bearbeiten">
                            ğŸš« <strong>{{ blocked_time.start_datetime|time:"H:i" }}</strong> {{ blocked_time.title }}
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<div style="margin-top: 20px; padding: 10px; background: #f9f9f9; border-radius: 5px;">
    <strong>Legende:</strong>
    <span style="display: inline-block; margin-left: 10px; padding: 3px 8px; background: #e3f2fd; border-left: 3px solid #2196f3;">Unterrichtsstunde (klickbar zum Bearbeiten)</span>
    <span style="display: inline-block; margin-left: 10px; padding: 3px 8px; background: #e3f2fd; border-left: 3px solid #dc3545;">âš  Konflikt</span>
    <span style="display: inline-block; margin-left: 10px; padding: 3px 8px; background: #fff3cd; border-left: 3px solid #ffc107;">ğŸš« Blockzeit (klickbar zum Bearbeiten)</span>
    <span style="display: inline-block; margin-left: 10px; color: #007bff; border-bottom: 1px dashed #007bff;">Tage (klickbar zum Anlegen)</span>
</div>
{% endblock %}
