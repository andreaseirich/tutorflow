{% extends 'core/base.html' %}
{% load i18n %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/lessons.css' %}">
{% endblock %}

{% block title %}{% if object %}{% trans 'Edit Lesson' %}{% else %}{% trans 'New Lesson' %}{% endif %} - TutorFlow{% endblock %}

{% block content %}
<h1>{% if object %}{% trans 'Edit Lesson' %}{% else %}{% trans 'New Lesson' %}{% endif %}</h1>

<form method="post">
    {% csrf_token %}
    
    <div class="form-section">
        <h3>{% trans 'Lesson Details' %}</h3>
        <p>
            <label for="{{ form.contract.id_for_label }}">{% trans 'Contract:' %}</label>
            {{ form.contract }}
        </p>
        <p>
            <label for="{{ form.date.id_for_label }}">{% trans 'Date:' %}</label>
            {{ form.date }}
        </p>
        <p>
            <label for="{{ form.start_time.id_for_label }}">{% trans 'Start Time:' %}</label>
            {{ form.start_time }}
        </p>
        <p>
            <label for="{{ form.duration_minutes.id_for_label }}">{% trans 'Duration (minutes):' %}</label>
            {{ form.duration_minutes }}
        </p>
        <p>
            <label for="{{ form.travel_time_before_minutes.id_for_label }}">{% trans 'Travel Time Before (minutes):' %}</label>
            {{ form.travel_time_before_minutes }}
        </p>
        <p>
            <label for="{{ form.travel_time_after_minutes.id_for_label }}">{% trans 'Travel Time After (minutes):' %}</label>
            {{ form.travel_time_after_minutes }}
        </p>
        <p>
            <label for="{{ form.notes.id_for_label }}">{% trans 'Notes:' %}</label>
            {{ form.notes }}
        </p>
    </div>
    
    {% if not object %}
    <div id="recurrence-section" class="recurrence-box">
        <h3>{% trans 'Recurrence (Optional)' %}</h3>
        <p>
            <label for="{{ form.is_recurring.id_for_label }}" class="inline-checkbox">
                {{ form.is_recurring }}
                <strong>{% trans 'Repeat this lesson' %}</strong>
            </label>
            {% if form.is_recurring.help_text %}
            <small class="muted">{{ form.is_recurring.help_text }}</small>
            {% endif %}
        </p>
        
        <div id="recurrence-fields" class="recurrence-fields">
            <p>
                <label for="{{ form.recurrence_type.id_for_label }}">{% trans 'Repeat pattern:' %}</label>
                {{ form.recurrence_type }}
            </p>
            <p>
                <label for="{{ form.recurrence_end_date.id_for_label }}">{% trans 'End date (optional):' %}</label>
                {{ form.recurrence_end_date }}
                {% if form.recurrence_end_date.help_text %}
                <small class="muted">{{ form.recurrence_end_date.help_text }}</small>
                {% endif %}
            </p>
            <p>
                <label>{% trans 'Weekdays:' %}</label>
                <div id="weekdays-container" class="weekdays-container">
                    {% for choice in form.recurrence_weekdays %}
                    <label class="inline-checkbox">
                        {{ choice.tag }}
                        <span>{{ choice.choice_label }}</span>
                    </label>
                    {% endfor %}
                </div>
                {% if form.recurrence_weekdays.help_text %}
                <small class="muted">{{ form.recurrence_weekdays.help_text }}</small>
                {% endif %}
            </p>
        </div>
    </div>
    {% endif %}
    
    <div class="btn-group">
        <button type="submit" class="btn btn-success">{% trans 'Save' %}</button>
        <a href="{% url 'lessons:week' %}" class="btn btn-secondary">{% trans 'Cancel' %}</a>
    </div>
</form>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/lesson_form.js' %}"></script>
{% endblock %}
